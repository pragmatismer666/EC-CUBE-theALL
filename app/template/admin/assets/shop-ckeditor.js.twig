<script>
    const currentRole = "{{ CURRENT_ROLE }}";
    const getImageUploadUrl = (shopId) => {
        if (currentRole === 'ROLE_ADMIN' && !shopId) {
            return "{{ url('malldevel_admin_image_upload') }}";
        }
        if (!shopId) {
            throw new Error('Shop ID is required');
        }
        return "{{ url('malldevel_admin_image_upload_with_id', { id : 95941192}) }}".replace('95941192', shopId);
    };

    if ( CKEDITOR.env.ie && CKEDITOR.env.version < 9 ) {
        CKEDITOR.tools.enableHtml5Elements( document );
    }

    const initCkeditor = (function() {

        // The trick to keep the editor in the sample quite small
        // unless user specified own height.
        CKEDITOR.config.height = 600;
        CKEDITOR.config.width = 'auto';
        CKEDITOR.config.extraPlugins = 'uploadimage';
        CKEDITOR.config.extraPlugins = 'videoembed';

        
        var wysiwygareaAvailable = isWysiwygareaAvailable(),
            isBBCodeBuiltIn = !!CKEDITOR.plugins.get( 'bbcode' );

        return function( options ) {

            var default_options = {
                selector_id      :   "editor",
                data    :   "Title",
                shop_id: null,
            }



            options = Object.assign(default_options, options)

            CKEDITOR.config.uploadUrl = getImageUploadUrl(options.shop_id);

            var editorElement = CKEDITOR.document.getById( options.selector_id );

            // :(((
            if ( isBBCodeBuiltIn ) {
                editorElement.setHtml(options.data);
            }

            // Depending on the wysiwygarea plugin availability initialize classic or inline editor.
            if ( wysiwygareaAvailable ) {
                {# CKEDITOR.replace( 'editor' ); #}
                CKEDITOR.replace( options.selector_id );
            } else {
                editorElement.setAttribute( 'contenteditable', 'true' );
                CKEDITOR.inline( options.selector_id );

                // TODO we can consider displaying some info box that
                // without wysiwygarea the classic editor may not work.
            }
        };

        function isWysiwygareaAvailable() {
            // If in development mode, then the wysiwygarea must be available.
            // Split REV into two strings so builder does not replace it :D.
            if ( CKEDITOR.revision == ( '%RE' + 'V%' ) ) {
                return true;
            }

            return !!CKEDITOR.plugins.get( 'wysiwygarea' );
        }
    })() ;

</script>
